<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>lmForc</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">lmForc</h1>
<h4 class="author">Nelson Rayl</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(lmForc)</span></code></pre></div>
<div id="sections" class="section level2">
<h2>Sections</h2>
<div id="forecast-class" class="section level4">
<h4><a href="#forecast-class-1">Forecast Class</a></h4>
</div>
<div id="is_forc" class="section level4">
<h4><a href="#is_forc-1">is_forc</a></h4>
</div>
<div id="oos_realized_forc" class="section level4">
<h4><a href="#oos_realized_forc-1">oos_realized_forc</a></h4>
</div>
<div id="oos_lag_forc" class="section level4">
<h4><a href="#oos_lag_forc-1">oos_lag_forc</a></h4>
</div>
<div id="oos_vintage_forc" class="section level4">
<h4><a href="#oos_vintage_forc-1">oos_vintage_forc</a></h4>
</div>
<div id="conditional_forc" class="section level4">
<h4><a href="#conditional_forc-1">conditional_forc</a></h4>
</div>
<div id="mse_weighted_forc" class="section level4">
<h4><a href="#mse_weighted_forc-1">mse_weighted_forc</a></h4>
</div>
</div>
<div id="lmforc-motivation" class="section level2">
<h2>lmForc Motivation</h2>
<p>Linear forecasting models have two main features: simplicity and interpretability. These features allow the performance of linear forecasting models to be tested in multiple ways, both in-sample and out-out-sample. The <em>lmForc</em> package brings these performance tests to the R language with a philosophy that compliments the features of linear models: One, the syntax for creating linear models is simple and the syntax for testing them should be equally simple. Two, performance tests should be realistic and when possible replicate what it would have been like to forecast in real time.</p>
</div>
<div id="forecast-class-1" class="section level2">
<h2>Forecast Class</h2>
<p>At the heart of the <em>lmForc</em> package is the <code>Forecast</code> class. Base R does not provide a good format for working with forecasts, so <em>lmForc</em> addresses this by introducing a new class for storing forecasts that is simple and rigorous. The <code>Forecast</code> class is paramount to the <em>lmForc</em> philosophy of simple syntax and realistic tests. <code>Forecast</code> is an S4 class that contains equal length vectors with the following data:</p>
<ul>
<li><code>origin</code>    The time when the forecast was made.</li>
<li><code>future</code>    The time that is being forecasted.</li>
<li><code>forecast</code> The forecast itself.</li>
<li><code>realized</code>  If available, the realized value at the time being forecasted.</li>
</ul>
<p>The <code>Forecast</code> class also includes an additional length-one slot <code>h_ahead</code> for representing how many periods ahead are being forecasted. This slot is optional, but becomes useful for documentation and performing out-of-sample forecast tests.</p>
<p>We demonstrate the <code>Forecast</code> class by constructing a simple <code>Forecast</code> object. This forecast contains four observations at the quarterly frequency.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>my_forecast &lt;-<span class="st"> </span><span class="kw">Forecast</span>(</span>
<span id="cb2-2"><a href="#cb2-2"></a>   <span class="dt">origin   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2010-03-31&quot;</span>, <span class="st">&quot;2010-06-30&quot;</span>, <span class="st">&quot;2010-09-30&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>)),</span>
<span id="cb2-3"><a href="#cb2-3"></a>   <span class="dt">future   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2011-03-31&quot;</span>, <span class="st">&quot;2011-06-30&quot;</span>, <span class="st">&quot;2011-09-30&quot;</span>, <span class="st">&quot;2011-12-31&quot;</span>)),</span>
<span id="cb2-4"><a href="#cb2-4"></a>   <span class="dt">forecast =</span> <span class="kw">c</span>(<span class="fl">4.21</span>, <span class="fl">4.27</span>, <span class="fl">5.32</span>, <span class="fl">5.11</span>),</span>
<span id="cb2-5"><a href="#cb2-5"></a>   <span class="dt">realized =</span> <span class="kw">c</span>(<span class="fl">4.40</span>, <span class="fl">4.45</span>, <span class="fl">4.87</span>, <span class="fl">4.77</span>),</span>
<span id="cb2-6"><a href="#cb2-6"></a>   <span class="dt">h_ahead  =</span> 4L</span>
<span id="cb2-7"><a href="#cb2-7"></a>)</span></code></pre></div>
<p>Note that we have chosen Date objects at the quarterly frequency for our <code>origin</code> and <code>future</code> slots. This forecast is for four quarters ahead, so we fill in the <code>h_ahead</code> slot with the integer four.</p>
<p>The <code>origin</code>, <code>future</code>, and <code>h_ahead</code> slots can be filled with any values. This is where the general nature of the <code>Forecast</code> class shines. In the <code>origin</code> and <code>future</code> slots we could use dates at a daily or yearly frequency, the <code>POSIXct</code> class to include minutes and seconds, or integers to represent discrete periods. We can also store different types of forecasts. In the example above, we have forecasts made at different <code>origin</code> times for a constant four quarter ahead forecast horizon. We could also store a forecast made at a single <code>origin</code> time for a horizon of <code>future</code> times by setting all of the <code>origin</code> values to one time and using <code>future</code> to represent the horizon of times that we are forecasting. In this case the <code>h_ahead</code> slot becomes irrelevant and it is left as <code>NULL</code>. The flexibility of these slots allows us to represent any type of numeric forecast.</p>
<p>The <code>forecast</code> and <code>realized</code> slots take numeric vectors. In the <code>forecast</code> slot we see the forecast that was made at each <code>origin</code> time and in the <code>realized</code> slot we see the true value that was realized at each <code>future</code> time. The realized values may not exist yet, so this slot may be partially populated or not populated at all. If the <code>realized</code> slot is set to <code>NULL</code> then it will be populated with a vector of <code>NA</code> values.</p>
<p>The <code>Forecast</code> class strikes a balance between simplicity and rigor. It is simple enough to store any numeric forecast, but it is rigorous enough to create a useful data structure. For example, we can quickly calculate the MSE or RMSE of the <code>Forecast</code> object we created above with only one argument.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">mse</span>(my_forecast)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">#&gt; [1] 0.09665</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">rmse</span>(my_forecast)</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt; [1] 0.3108858</span></span></code></pre></div>
<p>Because the <code>forecast</code> and <code>realized</code> slots must be numeric vectors, and all slots must be of the same length, we do not have to worry about input validation or coercing multiple vectors to the correct format when calculating MSE or RMSE.</p>
<p>MSE is calculated as:</p>
<p><span class="math display">\[
\hspace{8.45cm} n = \text{forecast vector length}\\[.20cm]
MSE = \frac{1}{n} \sum_{i=1}^{n}{(Y_i - \hat{Y_i})^2} 
\qquad \text{where} \quad Y_i = \text{realized values} \\
\hspace{7.3cm} \hat{Y_i} = \text{forecast values}
\]</span></p>
<p>RMSE is calculated as: <span class="math display">\[ RMSE = \sqrt{MSE}  \]</span></p>
<p>Note that these equations require two inputs, but because both inputs are already stored in the <code>Forecast</code> object we only need to pass one argument to the <code>mse()</code> and <code>rmse()</code> functions. Calculating forecast accuracy is a simple use case of the <code>Forecast</code> class. More complex use cases exist in the <em>lmForc</em> package, where many of the functions require inputs to be of the <code>Forecast</code> class. When weighting multiple forecasts or testing a linear model that is conditional on another forecast, the consistent structure of the class results in simple functions that execute correctly, no matter the type of forecast passed to the function. Furthermore, all <em>lmForc</em> functions return objects of the <code>Forecast</code> class which creates synergy between functions. One can take two linear models, test their performance out-of-sample with the <code>oos_realized_forc()</code> function which returns <code>Forecast</code> objects, and then pass these two objects to the <code>mse_weighted_forc()</code> function to find the weighted out-of-sample performance of both models.</p>
<p>One fear may be that the novel <code>Forecast</code> class will not play well with functions and packages that already exist in the R language. The <em>lmForc</em> package provides methods for accessing all of the vectors stored in a <code>Forecast</code> object as well as the <code>collect()</code> function which returns one or multiple <code>Forecast</code> objects as a data frame. With these methods, one can easily pass the data in a <code>Forecast</code> object to other functions.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">collect</span>(my_forecast)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#&gt;       origin     future my_forecast realized</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; 1 2010-03-31 2011-03-31        4.21     4.40</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt; 2 2010-06-30 2011-06-30        4.27     4.45</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; 3 2010-09-30 2011-09-30        5.32     4.87</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; 4 2010-12-31 2011-12-31        5.11     4.77</span></span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="kw">origin</span>(my_forecast)</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; [1] &quot;2010-03-31&quot; &quot;2010-06-30&quot; &quot;2010-09-30&quot; &quot;2010-12-31&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="kw">future</span>(my_forecast)</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; [1] &quot;2011-03-31&quot; &quot;2011-06-30&quot; &quot;2011-09-30&quot; &quot;2011-12-31&quot;</span></span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="kw">forc</span>(my_forecast)</span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; [1] 4.21 4.27 5.32 5.11</span></span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="kw">realized</span>(my_forecast)</span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; [1] 4.40 4.45 4.87 4.77</span></span></code></pre></div>
</div>
<div id="example-dataset" class="section level2">
<h2>Example Dataset</h2>
<p>Examples throughout the rest of the vignette will use a stylized dataset with a <code>date</code> column of ten quarterly dates, a dependent variable <code>y</code>, and two independent variables <code>x1</code> and <code>x2</code>. Equations are also written in terms of the variables <code>y</code>, <code>x1</code>, and <code>x2</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2010-03-31&quot;</span>, <span class="st">&quot;2010-06-30&quot;</span>, <span class="st">&quot;2010-09-30&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>,</span>
<span id="cb5-2"><a href="#cb5-2"></a>                  <span class="st">&quot;2011-03-31&quot;</span>, <span class="st">&quot;2011-06-30&quot;</span>, <span class="st">&quot;2011-09-30&quot;</span>, <span class="st">&quot;2011-12-31&quot;</span>, </span>
<span id="cb5-3"><a href="#cb5-3"></a>                  <span class="st">&quot;2012-03-31&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>))</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a>y  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.09</span>, <span class="fl">1.71</span>, <span class="fl">1.09</span>, <span class="fl">2.46</span>, <span class="fl">1.78</span>, <span class="fl">1.35</span>, <span class="fl">2.89</span>, <span class="fl">2.11</span>, <span class="fl">2.97</span>, <span class="fl">0.99</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a>x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">4.22</span>, <span class="fl">3.86</span>, <span class="fl">4.27</span>, <span class="fl">5.60</span>, <span class="fl">5.11</span>, <span class="fl">4.31</span>, <span class="fl">4.92</span>, <span class="fl">5.80</span>, <span class="fl">6.30</span>, <span class="fl">4.17</span>)</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a>x2  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">10.03</span>, <span class="fl">10.49</span>, <span class="fl">10.85</span>, <span class="fl">10.47</span>, <span class="fl">9.09</span>, <span class="fl">10.91</span>, <span class="fl">8.68</span>, <span class="fl">9.91</span>, <span class="fl">7.87</span>, <span class="fl">6.63</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a>data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(date, y, x1, x2)</span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="kw">head</span>(data)</span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt;         date    y   x1    x2</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt; 1 2010-03-31 1.09 4.22 10.03</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">#&gt; 2 2010-06-30 1.71 3.86 10.49</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">#&gt; 3 2010-09-30 1.09 4.27 10.85</span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co">#&gt; 4 2010-12-31 2.46 5.60 10.47</span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co">#&gt; 5 2011-03-31 1.78 5.11  9.09</span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co">#&gt; 6 2011-06-30 1.35 4.31 10.91</span></span></code></pre></div>
</div>
<div id="is_forc-1" class="section level2">
<h2>is_forc</h2>
<p>The <code>is_forc()</code> function produces an in-sample forecast based on a linear model. The function takes a linear model call and an optional vector of time data associated with the linear model as inputs. The linear model is estimated once over the entire sample period and the coefficients are multiplied by the realized values in each period of the sample. This is functionally identical to the <code>predict()</code> function in the <em>stats</em> package, but it returns a <code>Forecast</code> object instead of a numeric vector.</p>
<p>For all observations <em>i</em> in the sample, coefficients are estimated as:</p>
<p><span class="math display">\[ 
Y_i = \beta_0 + \beta_1 X1_i + \beta_2 X2_i + \epsilon_i 
\qquad \text{for all } i
\]</span> And forecasts are estimated as:</p>
<p><span class="math display">\[ 
forecast_i = \beta_0 + \beta_1 X1_i + \beta_2 X2_i \qquad
\]</span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">is_forc</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="dt">lm_call  =</span> <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, data),</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="dt">time_vec =</span> data<span class="op">$</span>date</span>
<span id="cb6-4"><a href="#cb6-4"></a>)</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; h_ahead = 0 </span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt;        origin     future forecast realized</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; 1  2010-03-31 2010-03-31 1.394370     1.09</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; 2  2010-06-30 2010-06-30 1.138708     1.71</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; 3  2010-09-30 2010-09-30 1.423339     1.09</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; 4  2010-12-31 2010-12-31 2.358107     2.46</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; 5  2011-03-31 2011-03-31 2.024964     1.78</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; 6  2011-06-30 2011-06-30 1.450924     1.35</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; 7  2011-09-30 2011-09-30 1.894861     2.89</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; 8  2011-12-31 2011-12-31 2.502394     2.11</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; 9  2012-03-31 2012-03-31 2.867846     2.97</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt; 10 2012-06-30 2012-06-30 1.384488     0.99</span></span></code></pre></div>
<p>Note that because we are creating an in-sample forecast, <code>h_ahead</code> is set to 0 and the <code>origin</code> time equals the <code>future</code> time. This test evaluates how well a linear forecast model fits the historical data.</p>
</div>
<div id="oos_realized_forc-1" class="section level2">
<h2>oos_realized_forc</h2>
<p>The <code>oos_realized_forc()</code> function produces an <em>h</em> period ahead out-of-sample forecast that is conditioned on realized values. The function takes a linear model call, an integer number of periods ahead to forecast, a period to end the initial coefficient estimation and begin forecasting, and an optional vector of time data associated with the linear model. The linear model is originally estimated with data up to <code>estimation_end</code>. Coefficients are multiplied by realized values of the covariates <code>h_ahead</code> periods ahead to create an <code>h_ahead</code> period ahead forecast. This process is iteratively repeated for each period after <code>estimation_end</code> with coefficients updating in each period as more information would have become available to the forecaster.</p>
<p>In the sample <em>i</em>, for each period <em>p</em> greater than or equal to <code>estimation_end</code>, coefficients are updated as:</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 X1_i + \beta_2 X2_i + \epsilon_i 
\qquad \text{for all} \quad i \leq \text{p}
\]</span> And <code>h_ahead</code> <em>h</em> forecasts are estimated as:</p>
<p><span class="math display">\[
forecast_{p+h} = \beta_0 + \beta_1 X1_{p+h} + \beta_2 X2_{p+h} \qquad
\]</span></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">oos_realized_forc</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="dt">lm_call =</span> <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, data),</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">h_ahead =</span> 2L,</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="dt">estimation_end =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2011-03-31&quot;</span>),</span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">time_vec =</span> data<span class="op">$</span>date</span>
<span id="cb7-6"><a href="#cb7-6"></a>)</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; h_ahead = 2 </span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt;       origin     future forecast realized</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; 1 2011-03-31 2011-09-30 1.623750     2.89</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; 2 2011-06-30 2011-12-31 2.341664     2.11</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt; 3 2011-09-30 2012-03-31 3.415198     2.97</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt; 4 2011-12-31 2012-06-30 2.708308     0.99</span></span></code></pre></div>
<p>Note that the <code>oos_realized_forc</code> function returns an out-of-sample forecast that conditions on realized values that <strong>would not</strong> have been available to the forecaster at the forecast origin. This test evaluates the performance of a linear forecast model had it been conditioned on perfect information.</p>
</div>
<div id="oos_lag_forc-1" class="section level2">
<h2>oos_lag_forc</h2>
<p>The <code>oos_lag_forc()</code> function produces an <em>h</em> period ahead out-of-sample forecast conditioned on present period values. The function takes a linear model call, an integer number of periods ahead to forecast, a period to end the initial coefficient estimation and begin forecasting, and an optional vector of time data associated with the linear model. The linear model data is lagged by <code>h_ahead</code> periods and the linear model is re-estimated with data up to <code>estimation_end</code> to create a lagged linear model. Coefficients are multiplied by present period realized values of the covariates to create a forecast for <code>h_ahead</code> periods ahead. This process is iteratively repeated for each period after <code>estimation_end</code> with coefficients updating in each period.</p>
<p>In the sample <em>i</em>, for each period <em>p</em> greater than or equal to <code>estimation_end</code>, coefficients are updated as:</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 X1_{i-h} + \beta_2 X2_{i-h} + \epsilon_i 
\qquad \text{for all} \quad i \leq \text{p}
\]</span> Where <em>h</em> is <code>h_ahead</code>. <code>h_ahead</code> forecasts are estimated as:</p>
<p><span class="math display">\[
forecast_{p+h} = \beta_0 + \beta_1 X1_{p} + \beta_2 X2_{p} \qquad
\]</span></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">oos_lag_forc</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="dt">lm_call =</span> <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, data),</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="dt">h_ahead =</span> 2L,</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="dt">estimation_end =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2011-03-31&quot;</span>),</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="dt">time_vec =</span> data<span class="op">$</span>date</span>
<span id="cb8-6"><a href="#cb8-6"></a>)</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; h_ahead = 2 </span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; </span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt;       origin     future  forecast realized</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt; 1 2011-03-31 2011-09-30 -2.100528     2.89</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; 2 2011-06-30 2011-12-31  2.174392     2.11</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; 3 2011-09-30 2012-03-31  2.813745     2.97</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt; 4 2011-12-31 2012-06-30  1.807014     0.99</span></span></code></pre></div>
<p>This test evaluates the performance of a lagged linear model had it been conditioned on present values that <strong>would</strong> have been available to the forecaster at the forecast origin. This is in contrast to conditioning on realized values or a forecast of the covariates.</p>
</div>
<div id="oos_vintage_forc-1" class="section level2">
<h2>oos_vintage_forc</h2>
<p>The <code>oos_vintage_forc()</code> function produces an out-of-sample forecast conditioned on <em>h</em> period ahead forecasts of the linear model covariates. The function takes a linear model call, a vector of time data associated with the linear model, and a vintage forecast for each covariate in the linear model. For each period in the vintage forecasts, coefficients are updated based on information that would have been available to the forecaster at the forecast origin. Coefficients are then multiplied by vintage forecast values.</p>
<p>In the sample <em>i</em>, for each period <em>p</em> in the vintage forecasts <em>VF1</em> and <em>VF2</em>, coefficients are updated as:</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 X1_i + \beta_2 X2_i + \epsilon_i 
\qquad \text{for all} \quad i \leq \text{p}
\]</span></p>
<p>And <code>h_ahead</code> <em>h</em> forecasts are estimated as:</p>
<p><span class="math display">\[
forecast_{p+h} = \beta_0 + \beta_1 VF1_p + \beta_2 VF2_p \qquad
\]</span></p>
<p>We introduce stylized vintage forecasts of X1 and X2 to demonstrate the <code>oos_vintage_forc()</code> function. Using four quarter ahead forecasts of the covariates X1 and X2, we create an out-of-sample forecast based on the coefficients and covariate forecasts that the forecaster would have used in each period.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>x1_forecast_vintage &lt;-<span class="st"> </span><span class="kw">Forecast</span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>   <span class="dt">origin   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2010-09-30&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>, <span class="st">&quot;2011-03-31&quot;</span>, <span class="st">&quot;2011-06-30&quot;</span>)),</span>
<span id="cb9-3"><a href="#cb9-3"></a>   <span class="dt">future   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2011-09-30&quot;</span>, <span class="st">&quot;2011-12-31&quot;</span>, <span class="st">&quot;2012-03-31&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>)),</span>
<span id="cb9-4"><a href="#cb9-4"></a>   <span class="dt">forecast =</span> <span class="kw">c</span>(<span class="fl">6.30</span>, <span class="fl">4.17</span>, <span class="fl">5.30</span>, <span class="fl">4.84</span>),</span>
<span id="cb9-5"><a href="#cb9-5"></a>   <span class="dt">realized =</span> <span class="kw">c</span>(<span class="fl">4.92</span>, <span class="fl">5.80</span>, <span class="fl">6.30</span>, <span class="fl">4.17</span>),</span>
<span id="cb9-6"><a href="#cb9-6"></a>   <span class="dt">h_ahead  =</span> 4L</span>
<span id="cb9-7"><a href="#cb9-7"></a>)</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a>x2_forecast_vintage &lt;-<span class="st"> </span><span class="kw">Forecast</span>(</span>
<span id="cb9-10"><a href="#cb9-10"></a>   <span class="dt">origin   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2010-09-30&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>, <span class="st">&quot;2011-03-31&quot;</span>, <span class="st">&quot;2011-06-30&quot;</span>)),</span>
<span id="cb9-11"><a href="#cb9-11"></a>   <span class="dt">future   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2011-09-30&quot;</span>, <span class="st">&quot;2011-12-31&quot;</span>, <span class="st">&quot;2012-03-31&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>)),</span>
<span id="cb9-12"><a href="#cb9-12"></a>   <span class="dt">forecast =</span> <span class="kw">c</span>(<span class="fl">7.32</span>, <span class="fl">6.88</span>, <span class="fl">6.82</span>, <span class="fl">6.95</span>),</span>
<span id="cb9-13"><a href="#cb9-13"></a>   <span class="dt">realized =</span> <span class="kw">c</span>(<span class="fl">8.68</span>, <span class="fl">9.91</span>, <span class="fl">7.87</span>, <span class="fl">6.63</span>),</span>
<span id="cb9-14"><a href="#cb9-14"></a>   <span class="dt">h_ahead  =</span> 4L</span>
<span id="cb9-15"><a href="#cb9-15"></a>)</span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="kw">oos_vintage_forc</span>(</span>
<span id="cb9-18"><a href="#cb9-18"></a>  <span class="dt">lm_call =</span> <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, data),</span>
<span id="cb9-19"><a href="#cb9-19"></a>  <span class="dt">time_vec =</span> data<span class="op">$</span>date,</span>
<span id="cb9-20"><a href="#cb9-20"></a>  x1_forecast_vintage, x2_forecast_vintage</span>
<span id="cb9-21"><a href="#cb9-21"></a>)</span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">#&gt; h_ahead = 4 </span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co">#&gt; </span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">#&gt;       origin     future  forecast realized</span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="co">#&gt; 1 2010-09-30 2011-09-30 -2.497310     2.89</span></span>
<span id="cb9-26"><a href="#cb9-26"></a><span class="co">#&gt; 2 2010-12-31 2011-12-31  1.194088     2.11</span></span>
<span id="cb9-27"><a href="#cb9-27"></a><span class="co">#&gt; 3 2011-03-31 2012-03-31  1.620716     2.97</span></span>
<span id="cb9-28"><a href="#cb9-28"></a><span class="co">#&gt; 4 2011-06-30 2012-06-30  1.470027     0.99</span></span></code></pre></div>
<p>This test replicates the forecasts that a linear model conditional on forecasts of covariates would have produced in real time. Here we see the strength of the <code>Forecast</code> class. Because the vintage forecasts of X1 and X2 share the same data structure, we can calculate a forecast that is conditional on these objects without fearing inconsistency across inputs.</p>
</div>
<div id="conditional_forc-1" class="section level2">
<h2>conditional_forc</h2>
<p>The <code>conditional_forc()</code> function produces a forecast conditioned on forecasts of the linear model covariates. The function takes a linear model call, a vector of time data associated with the linear model, and a forecast for each covariate in the linear model. The linear model is estimated once over the entire sample period and the coefficients are multiplied by the forecasts of each covariate.</p>
<p>For all observations <em>i</em> in the sample, coefficients are estimated as:</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 X1_i + \beta_2 X2_i + \epsilon_i 
\qquad \text{for all } i
\]</span></p>
<p>And for all periods <em>p</em> in the covariate forecasts <em>F1</em> and <em>F2</em>, forecasts are estimated as:</p>
<p><span class="math display">\[ 
forecast_{p+h} = \beta_0 + \beta_1 F1_p + \beta_2 F2_p \qquad
\]</span></p>
<p>The difference between <code>conditional_forc()</code> and <code>oos_vintage_forc()</code> is that in the <code>conditional_forc()</code> function coefficients are only estimated once over all observations. Coefficients do not update based on what information would have been available to the forecaster at any given point in time. We introduce stylized forecasts of X1 and X2 to demonstrate the <code>conditional_forc()</code> function. Because in this example we are making a conditional forecast for the future instead of testing past forecasts, we can condition on a horizon of forecasts. This is in contrast to the <code>oos_vintage_forc()</code> example where we test the performance of four quarter ahead vintage forecasts.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>x1_forecast &lt;-<span class="st"> </span><span class="kw">Forecast</span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>   <span class="dt">origin   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2012-06-30&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>)),</span>
<span id="cb10-3"><a href="#cb10-3"></a>   <span class="dt">future   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2012-09-30&quot;</span>, <span class="st">&quot;2012-12-31&quot;</span>, <span class="st">&quot;2013-03-31&quot;</span>, <span class="st">&quot;2013-06-30&quot;</span>)),</span>
<span id="cb10-4"><a href="#cb10-4"></a>   <span class="dt">forecast =</span> <span class="kw">c</span>(<span class="fl">4.14</span>, <span class="fl">4.04</span>, <span class="fl">4.97</span>, <span class="fl">5.12</span>),</span>
<span id="cb10-5"><a href="#cb10-5"></a>   <span class="dt">realized =</span> <span class="ot">NULL</span>,</span>
<span id="cb10-6"><a href="#cb10-6"></a>   <span class="dt">h_ahead  =</span> <span class="ot">NULL</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>)</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>x2_forecast &lt;-<span class="st"> </span><span class="kw">Forecast</span>(</span>
<span id="cb10-10"><a href="#cb10-10"></a>   <span class="dt">origin   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2012-06-30&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>)),</span>
<span id="cb10-11"><a href="#cb10-11"></a>   <span class="dt">future   =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2012-09-30&quot;</span>, <span class="st">&quot;2012-12-31&quot;</span>, <span class="st">&quot;2013-03-31&quot;</span>, <span class="st">&quot;2013-06-30&quot;</span>)),</span>
<span id="cb10-12"><a href="#cb10-12"></a>   <span class="dt">forecast =</span> <span class="kw">c</span>(<span class="fl">6.01</span>, <span class="fl">6.05</span>, <span class="fl">6.55</span>, <span class="fl">7.45</span>),</span>
<span id="cb10-13"><a href="#cb10-13"></a>   <span class="dt">realized =</span> <span class="ot">NULL</span>,</span>
<span id="cb10-14"><a href="#cb10-14"></a>   <span class="dt">h_ahead  =</span> <span class="ot">NULL</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>)</span>
<span id="cb10-16"><a href="#cb10-16"></a></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="kw">conditional_forc</span>(</span>
<span id="cb10-18"><a href="#cb10-18"></a>  <span class="dt">lm_call =</span> <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, data),</span>
<span id="cb10-19"><a href="#cb10-19"></a>  <span class="dt">time_vec =</span> data<span class="op">$</span>date,</span>
<span id="cb10-20"><a href="#cb10-20"></a>  x1_forecast, x2_forecast</span>
<span id="cb10-21"><a href="#cb10-21"></a>)</span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">#&gt; h_ahead = </span></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">#&gt; </span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co">#&gt;       origin     future forecast realized</span></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">#&gt; 1 2012-06-30 2012-09-30 1.368054       NA</span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co">#&gt; 2 2012-06-30 2012-12-31 1.297686       NA</span></span>
<span id="cb10-27"><a href="#cb10-27"></a><span class="co">#&gt; 3 2012-06-30 2013-03-31 1.945655       NA</span></span>
<span id="cb10-28"><a href="#cb10-28"></a><span class="co">#&gt; 4 2012-06-30 2013-06-30 2.044105       NA</span></span></code></pre></div>
<p>This function is used to create a forecast for the present period or replicate a forecast made at a specific period in the past. Note that because we are forecasting into the future, <code>realized</code> is <code>NULL</code>. Also, because we are forecasting a horizon of dates, <code>h_ahead</code> is <code>NULL</code>.</p>
</div>
<div id="mse_weighted_forc-1" class="section level2">
<h2>mse_weighted_forc</h2>
<p>The <code>mse_weighted_forc()</code> function produces a weighted average of multiple forecasts based on the recent performance of each forecast. The function takes two or more forecasts of the <code>Forecast</code> class, an evaluation window, and an error function. For each forecast period, the error function is used to calculate forecast accuracy over the past <code>eval_window</code> number of periods. The forecast accuracy of each forecast is then used to weight forecasts based on a weighting function. In each period, weights are calculated and used to create a weighted average forecast. We use a stylized example in which we create a weighted forecast of two forecasts: Y1 and Y2.</p>
<p>For all periods <em>p</em> in the <em>k</em> number of forecasts <em>Y</em>, weights <em>W</em> are calculated over the <code>eval_window</code> <em>e</em> as:</p>
<p><span class="math display">\[
W_n = \frac{1/MSE(Y_{kE})}{1/\sum_{k=1}^{n}MSE(Y_{kE})} \qquad \text{where} 
\quad E = \{(p-e)..p\} 
\]</span></p>
<p>Forecasts are estimated as:</p>
<p><span class="math display">\[
forecast_p = Y1_pW_1 + Y2_pW_2
\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>y1_forecast &lt;-<span class="st"> </span><span class="kw">Forecast</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="dt">origin =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2009-03-31&quot;</span>, <span class="st">&quot;2009-06-30&quot;</span>, <span class="st">&quot;2009-09-30&quot;</span>, <span class="st">&quot;2009-12-31&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3"></a>                     <span class="st">&quot;2010-03-31&quot;</span>, <span class="st">&quot;2010-06-30&quot;</span>, <span class="st">&quot;2010-09-30&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>, </span>
<span id="cb11-4"><a href="#cb11-4"></a>                     <span class="st">&quot;2011-03-31&quot;</span>, <span class="st">&quot;2011-06-30&quot;</span>)),</span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="dt">future =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2010-03-31&quot;</span>, <span class="st">&quot;2010-06-30&quot;</span>, <span class="st">&quot;2010-09-30&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>                     <span class="st">&quot;2011-03-31&quot;</span>, <span class="st">&quot;2011-06-30&quot;</span>, <span class="st">&quot;2011-09-30&quot;</span>, <span class="st">&quot;2011-12-31&quot;</span>, </span>
<span id="cb11-7"><a href="#cb11-7"></a>                     <span class="st">&quot;2012-03-31&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>)),</span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="dt">forecast =</span> <span class="kw">c</span>(<span class="fl">1.33</span>, <span class="fl">1.36</span>, <span class="fl">1.38</span>, <span class="fl">1.68</span>, <span class="fl">1.60</span>, <span class="fl">1.55</span>, <span class="fl">1.32</span>, <span class="fl">1.22</span>, <span class="fl">1.08</span>, <span class="fl">0.88</span>),</span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="dt">realized =</span> <span class="kw">c</span>(<span class="fl">1.09</span>, <span class="fl">1.71</span>, <span class="fl">1.09</span>, <span class="fl">2.46</span>, <span class="fl">1.78</span>, <span class="fl">1.35</span>, <span class="fl">2.89</span>, <span class="fl">2.11</span>, <span class="fl">2.97</span>, <span class="fl">0.99</span>),</span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="dt">h_ahead =</span> 4L</span>
<span id="cb11-11"><a href="#cb11-11"></a>)</span>
<span id="cb11-12"><a href="#cb11-12"></a></span>
<span id="cb11-13"><a href="#cb11-13"></a>y2_forecast &lt;-<span class="st"> </span><span class="kw">Forecast</span>(</span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="dt">origin =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2009-03-31&quot;</span>, <span class="st">&quot;2009-06-30&quot;</span>, <span class="st">&quot;2009-09-30&quot;</span>, <span class="st">&quot;2009-12-31&quot;</span>,</span>
<span id="cb11-15"><a href="#cb11-15"></a>                     <span class="st">&quot;2010-03-31&quot;</span>, <span class="st">&quot;2010-06-30&quot;</span>, <span class="st">&quot;2010-09-30&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>, </span>
<span id="cb11-16"><a href="#cb11-16"></a>                     <span class="st">&quot;2011-03-31&quot;</span>, <span class="st">&quot;2011-06-30&quot;</span>)),</span>
<span id="cb11-17"><a href="#cb11-17"></a>  <span class="dt">future =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2010-03-31&quot;</span>, <span class="st">&quot;2010-06-30&quot;</span>, <span class="st">&quot;2010-09-30&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>,</span>
<span id="cb11-18"><a href="#cb11-18"></a>                     <span class="st">&quot;2011-03-31&quot;</span>, <span class="st">&quot;2011-06-30&quot;</span>, <span class="st">&quot;2011-09-30&quot;</span>, <span class="st">&quot;2011-12-31&quot;</span>, </span>
<span id="cb11-19"><a href="#cb11-19"></a>                     <span class="st">&quot;2012-03-31&quot;</span>, <span class="st">&quot;2012-06-30&quot;</span>)),</span>
<span id="cb11-20"><a href="#cb11-20"></a>  <span class="dt">forecast =</span> <span class="kw">c</span>(<span class="fl">0.70</span>, <span class="fl">0.88</span>, <span class="fl">1.03</span>, <span class="fl">1.05</span>, <span class="fl">1.01</span>, <span class="fl">0.82</span>, <span class="fl">0.95</span>, <span class="fl">1.09</span>, <span class="fl">1.07</span>, <span class="fl">1.06</span>),</span>
<span id="cb11-21"><a href="#cb11-21"></a>  <span class="dt">realized =</span> <span class="kw">c</span>(<span class="fl">1.09</span>, <span class="fl">1.71</span>, <span class="fl">1.09</span>, <span class="fl">2.46</span>, <span class="fl">1.78</span>, <span class="fl">1.35</span>, <span class="fl">2.89</span>, <span class="fl">2.11</span>, <span class="fl">2.97</span>, <span class="fl">0.99</span>),</span>
<span id="cb11-22"><a href="#cb11-22"></a>  <span class="dt">h_ahead =</span> 4L</span>
<span id="cb11-23"><a href="#cb11-23"></a>)</span>
<span id="cb11-24"><a href="#cb11-24"></a></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="kw">mse_weighted_forc</span>(</span>
<span id="cb11-26"><a href="#cb11-26"></a>  y1_forecast, y2_forecast,</span>
<span id="cb11-27"><a href="#cb11-27"></a>  <span class="dt">eval_window =</span> 2L,</span>
<span id="cb11-28"><a href="#cb11-28"></a>  <span class="dt">errors =</span> <span class="st">&quot;mse&quot;</span>,</span>
<span id="cb11-29"><a href="#cb11-29"></a>  <span class="dt">return_weights =</span> <span class="ot">FALSE</span></span>
<span id="cb11-30"><a href="#cb11-30"></a>)</span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="co">#&gt; h_ahead = 4 </span></span>
<span id="cb11-32"><a href="#cb11-32"></a><span class="co">#&gt; </span></span>
<span id="cb11-33"><a href="#cb11-33"></a><span class="co">#&gt;        origin     future forecast realized</span></span>
<span id="cb11-34"><a href="#cb11-34"></a><span class="co">#&gt; 1  2009-03-31 2010-03-31       NA     1.09</span></span>
<span id="cb11-35"><a href="#cb11-35"></a><span class="co">#&gt; 2  2009-06-30 2010-06-30       NA     1.71</span></span>
<span id="cb11-36"><a href="#cb11-36"></a><span class="co">#&gt; 3  2009-09-30 2010-09-30       NA     1.09</span></span>
<span id="cb11-37"><a href="#cb11-37"></a><span class="co">#&gt; 4  2009-12-31 2010-12-31       NA     2.46</span></span>
<span id="cb11-38"><a href="#cb11-38"></a><span class="co">#&gt; 5  2010-03-31 2011-03-31       NA     1.78</span></span>
<span id="cb11-39"><a href="#cb11-39"></a><span class="co">#&gt; 6  2010-06-30 2011-06-30 1.421244     1.35</span></span>
<span id="cb11-40"><a href="#cb11-40"></a><span class="co">#&gt; 7  2010-09-30 2011-09-30 1.234979     2.89</span></span>
<span id="cb11-41"><a href="#cb11-41"></a><span class="co">#&gt; 8  2010-12-31 2011-12-31 1.186461     2.11</span></span>
<span id="cb11-42"><a href="#cb11-42"></a><span class="co">#&gt; 9  2011-03-31 2012-03-31 1.078011     2.97</span></span>
<span id="cb11-43"><a href="#cb11-43"></a><span class="co">#&gt; 10 2011-06-30 2012-06-30 0.893773     0.99</span></span></code></pre></div>
<p>The <code>mse_weighted_forc()</code> function returns a weighted forecast of the Y1 and Y2 forecasts based on performance in recent periods. The weights used in each period can be returned to the Global Environment by setting <code>return_weights</code> to <code>TRUE</code>. Note that although we were only weighting performance over the past two periods, we have five <code>NA</code> forecasts. This reflects the <em>lmForc</em> philosophy of replicating what it would be like to forecast in real time. If a forecaster was making a forecast at <code>2010-06-30</code>, they would only have access to realized values up to <code>2010-06-30</code>, in this case the first two rows. This is why a weighted forecast with an <code>eval_window</code> of two can only be computed once the forecast origin becomes <code>2010-06-30</code> and the forecaster has access to two realized values. This function can be used to compute a weighted forecast for the present period or to test how a weighted forecast would have performed historically.</p>
<p></br> </br></p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
